{"version":3,"names":["TopoSort","require","_","Graph","constructor","json","topo","nodes","cloneDeep","isEmpty","edges","forOwn","targets","source","add","startNodes","endNodes","hasNode","key","getNode","setNode","value","setEdge","sourceNode","targetNode","Error","getTargetNodes","Array","from","mapOfDependents","getSourceNodes","mapOfDependencies","calcStartEnd","seq","sort","takeWhile","e","hasDependency","takeRightWhile","hasDependent","length","Object","keys","toJSON","mapValues","module","exports"],"sources":["Graph.js"],"sourcesContent":["const TopoSort = require('./TopoSort');\nconst { _ } = require('@genx/july');\n\nclass Graph {\n    constructor(json) {\n        this.topo = new TopoSort();\n\n        if (json) {\n            this.nodes = _.cloneDeep(json.nodes);\n            if (!_.isEmpty(json.edges)) {\n                _.forOwn(json.edges, (targets, source) => {\n                    this.topo.add(source, targets);\n                });\n            }\n            this.startNodes = json.startNodes;\n            this.endNodes = json.endNodes;\n        } else {\n            this.nodes = {};\n        }\n    }\n\n    hasNode(key) {\n        return key in this.nodes;\n    }\n\n    getNode(key) {\n        return this.nodes[key];\n    }\n\n    setNode(key, value) {\n        this.nodes[key] = value;\n        return this;\n    }\n\n    setEdge(sourceNode, targetNode) {\n        if (!this.hasNode(sourceNode)) {\n            throw new Error(`Source node [${sourceNode}] not exists.`);\n        }\n        if (!this.hasNode(targetNode)) {\n            throw new Error(`Target node [${targetNode}] not exists.`);\n        }\n        this.topo.add(sourceNode, targetNode);\n        return this;\n    }\n\n    getTargetNodes(sourceNode) {\n        return Array.from(this.topo.mapOfDependents[sourceNode]);\n    }\n\n    getSourceNodes(targetNode) {\n        return Array.from(this.topo.mapOfDependencies[targetNode]);\n    }\n\n    calcStartEnd() {\n        const seq = this.topo.sort();\n        this.startNodes = _.takeWhile(seq, (e) => !this.topo.hasDependency(e));\n        this.endNodes = _.takeRightWhile(\n            seq,\n            (e) => !this.topo.hasDependent(e)\n        );\n\n        if (this.startNodes.length === 0) {\n            this.startNodes = Object.keys(this.nodes);\n        }\n\n        if (this.endNodes.length === 0) {\n            this.endNodes = Object.keys(this.nodes);\n        }\n\n        return this;\n    }\n\n    toJSON() {\n        return {\n            nodes: this.nodes,\n            edges: _.mapValues(this.topo.mapOfDependents, (nodes) =>\n                Array.from(nodes)\n            ),\n            startNodes: this.startNodes,\n            endNodes: this.endNodes,\n        };\n    }\n}\n\nmodule.exports = Graph;\n"],"mappings":"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"}